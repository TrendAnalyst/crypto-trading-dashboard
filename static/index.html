<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TrendScope Pro – Multi-Timeframe Trading Signals</title>
    <meta name="description" content="Professional cryptocurrency trading signals dashboard with real-time multi-timeframe trend analysis">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Inter', 'system-ui', 'sans-serif'] },
                    colors: {
                        dark: { 950: '#05050a', 900: '#0a0a10', 850: '#0d0d15', 800: '#12121c', 700: '#1a1a28' },
                        brand: { 500: '#6366f1', 400: '#818cf8', 300: '#a5b4fc' }
                    }
                }
            }
        }
    </script>
    <style>
        * { box-sizing: border-box; }
        body { background: #05050a; }
        
        /* Gradient backgrounds */
        .bg-mesh {
            background: 
                radial-gradient(ellipse 80% 50% at 50% -20%, rgba(99, 102, 241, 0.15), transparent),
                radial-gradient(ellipse 50% 50% at 100% 50%, rgba(139, 92, 246, 0.08), transparent),
                radial-gradient(ellipse 50% 50% at 0% 80%, rgba(59, 130, 246, 0.06), transparent);
        }
        
        /* Glass card */
        .glass-card {
            background: linear-gradient(135deg, rgba(15, 15, 25, 0.9) 0%, rgba(10, 10, 18, 0.95) 100%);
            border: 1px solid rgba(255, 255, 255, 0.05);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5), 
                        0 0 0 1px rgba(255, 255, 255, 0.02) inset;
        }
        
        /* Premium header */
        .header-glow {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(139, 92, 246, 0.05));
            border-bottom: 1px solid rgba(99, 102, 241, 0.1);
        }
        
        /* Table styling */
        .data-table { border-collapse: separate; border-spacing: 0; }
        .data-table thead th {
            background: linear-gradient(180deg, rgba(15, 15, 25, 0.98) 0%, rgba(10, 10, 18, 0.98) 100%);
            backdrop-filter: blur(10px);
            position: sticky;
            top: 0;
            z-index: 20;
        }
        .data-row {
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .data-row:hover {
            background: linear-gradient(90deg, rgba(99, 102, 241, 0.08), transparent);
            transform: translateX(4px);
        }
        .data-row:hover .coin-icon {
            transform: scale(1.1) rotate(-3deg);
            box-shadow: 0 8px 16px rgba(99, 102, 241, 0.25);
        }
        .data-row:hover .coin-name {
            color: #a5b4fc;
        }
        
        /* Coin icons with gradients */
        .coin-icon {
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        .coin-icon::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent 40%, rgba(255,255,255,0.1) 50%, transparent 60%);
            transform: rotate(45deg);
            transition: all 0.5s;
        }
        .coin-icon:hover::before {
            left: 100%;
        }
        
        /* Score visualization */
        .score-bar-container {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 6px;
            overflow: hidden;
        }
        .score-bar {
            height: 6px;
            border-radius: 6px;
            transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
        }
        .score-bar.bullish {
            background: linear-gradient(90deg, #10b981, #34d399);
            box-shadow: 0 0 20px rgba(16, 185, 129, 0.4);
        }
        .score-bar.bearish {
            background: linear-gradient(90deg, #f43f5e, #fb7185);
            box-shadow: 0 0 20px rgba(244, 63, 94, 0.4);
        }
        
        /* Trend indicators */
        .trend-indicator {
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 36px;
            height: 36px;
            border-radius: 10px;
        }
        .trend-indicator.up {
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid rgba(16, 185, 129, 0.2);
            color: #34d399;
        }
        .trend-indicator.down {
            background: rgba(244, 63, 94, 0.1);
            border: 1px solid rgba(244, 63, 94, 0.2);
            color: #fb7185;
        }
        .trend-indicator.neutral {
            background: rgba(100, 116, 139, 0.1);
            border: 1px solid rgba(100, 116, 139, 0.15);
            color: #64748b;
        }
        .data-row:hover .trend-indicator {
            transform: scale(1.1);
        }
        
        /* Signal badges */
        .signal-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 6px 12px;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.2s ease;
        }
        .signal-badge.buy {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.15), rgba(16, 185, 129, 0.05));
            border: 1px solid rgba(16, 185, 129, 0.25);
            color: #34d399;
        }
        .signal-badge.sell {
            background: linear-gradient(135deg, rgba(244, 63, 94, 0.15), rgba(244, 63, 94, 0.05));
            border: 1px solid rgba(244, 63, 94, 0.25);
            color: #fb7185;
        }
        .signal-badge:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }
        
        /* Sort buttons */
        .sort-pill {
            padding: 8px 16px;
            border-radius: 10px;
            font-size: 13px;
            font-weight: 500;
            color: #64748b;
            transition: all 0.2s ease;
            border: 1px solid transparent;
        }
        .sort-pill:hover {
            color: #a5b4fc;
            background: rgba(99, 102, 241, 0.1);
        }
        .sort-pill.active {
            color: #fff;
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.2), rgba(139, 92, 246, 0.15));
            border-color: rgba(99, 102, 241, 0.3);
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.15);
        }
        
        /* Status pill */
        .status-pill {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(16, 185, 129, 0.05));
            border: 1px solid rgba(16, 185, 129, 0.2);
        }
        
        /* Live indicator */
        .live-pulse {
            animation: livePulse 2s ease-in-out infinite;
        }
        @keyframes livePulse {
            0%, 100% { opacity: 1; box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.4); }
            50% { opacity: 0.8; box-shadow: 0 0 0 8px rgba(16, 185, 129, 0); }
        }
        
        /* Scrollbar */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: rgba(0, 0, 0, 0.2); border-radius: 4px; }
        ::-webkit-scrollbar-thumb { background: rgba(99, 102, 241, 0.3); border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: rgba(99, 102, 241, 0.5); }
        
        /* Logo animation */
        .logo-glow {
            animation: logoGlow 3s ease-in-out infinite;
        }
        @keyframes logoGlow {
            0%, 100% { box-shadow: 0 0 20px rgba(99, 102, 241, 0.3), 0 0 40px rgba(139, 92, 246, 0.2); }
            50% { box-shadow: 0 0 30px rgba(99, 102, 241, 0.5), 0 0 60px rgba(139, 92, 246, 0.3); }
        }
        
        /* Coin name hover */
        .coin-name {
            transition: color 0.2s ease;
        }
        
        /* Score number */
        .score-value {
            font-variant-numeric: tabular-nums;
            transition: all 0.2s ease;
        }
        .data-row:hover .score-value {
            transform: scale(1.1);
        }
        
        /* Footer gradient */
        .footer-fade {
            background: linear-gradient(180deg, transparent, rgba(5, 5, 10, 0.8));
        }
    </style>
</head>
<body class="text-gray-100 min-h-screen font-sans antialiased bg-mesh">
    
    <!-- Header -->
    <header class="header-glow sticky top-0 z-50 backdrop-blur-xl">
        <div class="max-w-7xl mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <!-- Brand -->
                <div class="flex items-center gap-4">
                    <div class="logo-glow w-11 h-11 rounded-xl bg-gradient-to-br from-indigo-500 via-purple-500 to-pink-500 flex items-center justify-center">
                        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"/>
                        </svg>
                    </div>
                    <div>
                        <h1 class="text-xl font-bold text-white">TrendScope<span class="text-indigo-400">Pro</span></h1>
                        <p class="text-xs text-gray-500">Multi-Timeframe Signal Analysis</p>
                    </div>
                </div>
                
                <!-- Right side -->
                <div class="flex items-center gap-4">
                    <!-- Sort controls -->
                    <div class="hidden md:flex items-center bg-dark-800/50 rounded-xl p-1 border border-white/5">
                        <button onclick="sortCoins('score', 'desc')" id="sort-bullish" class="sort-pill active">
                            <span class="flex items-center gap-1.5">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7"/></svg>
                                Bullish
                            </span>
                        </button>
                        <button onclick="sortCoins('score', 'asc')" id="sort-bearish" class="sort-pill">
                            <span class="flex items-center gap-1.5">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg>
                                Bearish
                            </span>
                        </button>
                        <button onclick="sortCoins('name', 'asc')" id="sort-name" class="sort-pill">A–Z</button>
                    </div>
                    
                    <!-- Status -->
                    <div class="status-pill flex items-center gap-3 px-4 py-2 rounded-xl">
                        <div class="live-pulse w-2.5 h-2.5 bg-emerald-400 rounded-full"></div>
                        <span class="text-sm text-emerald-400 font-medium">Live</span>
                        <div class="h-4 w-px bg-emerald-500/20"></div>
                        <span class="text-sm font-bold text-white" id="coin-count">0</span>
                        <span class="text-xs text-gray-500">assets</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main content -->
    <main class="max-w-7xl mx-auto px-6 py-8">
        
        <!-- Loading state -->
        <div id="loading" class="flex flex-col items-center justify-center py-32">
            <div class="relative">
                <div class="w-16 h-16 rounded-full border-4 border-dark-700"></div>
                <div class="absolute inset-0 w-16 h-16 rounded-full border-4 border-indigo-500 border-t-transparent animate-spin"></div>
            </div>
            <p class="mt-6 text-gray-500">Loading market data...</p>
        </div>

        <!-- Error state -->
        <div id="error" class="hidden">
            <div class="glass-card rounded-2xl p-12 text-center max-w-md mx-auto">
                <div class="w-16 h-16 rounded-2xl bg-red-500/10 flex items-center justify-center mx-auto mb-6">
                    <svg class="w-8 h-8 text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
                    </svg>
                </div>
                <h3 class="text-lg font-semibold text-white mb-2">Connection Error</h3>
                <p class="text-gray-500 text-sm mb-6">Unable to load market data. Please try again.</p>
                <button onclick="fetchCoins()" class="px-6 py-3 bg-gradient-to-r from-indigo-500 to-purple-500 hover:from-indigo-600 hover:to-purple-600 rounded-xl text-sm font-semibold transition-all shadow-lg shadow-indigo-500/25 hover:shadow-indigo-500/40">
                    Retry Connection
                </button>
            </div>
        </div>

        <!-- Data table -->
        <div id="table-container" class="hidden">
            <div class="glass-card rounded-2xl overflow-hidden">
                <div class="overflow-x-auto">
                    <table class="data-table w-full">
                        <thead>
                            <tr class="text-left text-[11px] uppercase tracking-widest text-gray-500 border-b border-white/5">
                                <th class="px-6 py-5 font-semibold">Asset</th>
                                <th class="px-4 py-5 font-semibold text-center" style="width: 140px;">Trend Score</th>
                                <th class="px-4 py-5 font-semibold text-center" style="width: 80px;">1W</th>
                                <th class="px-4 py-5 font-semibold text-center" style="width: 80px;">3D</th>
                                <th class="px-4 py-5 font-semibold text-center" style="width: 80px;">1D</th>
                                <th class="px-4 py-5 font-semibold" style="width: 160px;">Latest Signal</th>
                                <th class="px-6 py-5 font-semibold text-right" style="width: 100px;">Updated</th>
                            </tr>
                        </thead>
                        <tbody id="coins-table" class="divide-y divide-white/[0.02]"></tbody>
                    </table>
                </div>
            </div>
            
            <!-- Legend -->
            <div class="mt-6 flex flex-wrap items-center justify-between gap-4 text-xs text-gray-600">
                <div class="flex items-center gap-6">
                    <span class="flex items-center gap-2">
                        <span class="w-3 h-3 rounded bg-gradient-to-r from-emerald-500 to-emerald-400"></span>
                        Uptrend
                    </span>
                    <span class="flex items-center gap-2">
                        <span class="w-3 h-3 rounded bg-gradient-to-r from-rose-500 to-rose-400"></span>
                        Downtrend
                    </span>
                    <span class="text-gray-700">|</span>
                    <span>Score: 1W (±6) · 3D (±3) · 1D (±1)</span>
                </div>
                <div class="flex items-center gap-2">
                    <span class="text-gray-500">Last sync:</span>
                    <span id="last-update" class="text-gray-400 font-medium">—</span>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="fixed bottom-0 left-0 right-0 footer-fade pointer-events-none">
        <div class="max-w-7xl mx-auto px-6 py-4">
            <p class="text-center text-xs text-gray-700">
                TrendScope Pro © 2026 · Real-time market analysis
            </p>
        </div>
    </footer>

    <script>
        // === CONFIG ===
        const REFRESH_INTERVAL = 30000;
        let coinsData = [];
        let currentSort = { field: 'score', direction: 'desc' };

        // === SCORE: 1W=6, 3D=3, 1D=1 ===
        function calculateScore(trends) {
            let score = 0;
            if (trends['1w'] === 'uptrend') score += 6;
            else if (trends['1w'] === 'downtrend') score -= 6;
            if (trends['3d'] === 'uptrend') score += 3;
            else if (trends['3d'] === 'downtrend') score -= 3;
            if (trends['1d'] === 'uptrend') score += 1;
            else if (trends['1d'] === 'downtrend') score -= 1;
            return score;
        }

        // === SORTING ===
        function sortCoins(field, direction) {
            currentSort = { field, direction };
            document.querySelectorAll('.sort-pill').forEach(b => b.classList.remove('active'));
            const id = field === 'score' ? (direction === 'desc' ? 'sort-bullish' : 'sort-bearish') : 'sort-name';
            document.getElementById(id)?.classList.add('active');
            renderTable();
        }

        // === FETCH ===
        async function fetchCoins() {
            try {
                const res = await fetch('/api/coins');
                if (!res.ok) throw new Error('Failed');
                const data = await res.json();
                coinsData = data.coins.map(c => ({ ...c, score: calculateScore(c.trends) }));
                document.getElementById('coin-count').textContent = data.total_coins;
                document.getElementById('loading').classList.add('hidden');
                document.getElementById('error').classList.add('hidden');
                document.getElementById('table-container').classList.remove('hidden');
                document.getElementById('last-update').textContent = new Date().toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
                renderTable();
            } catch (e) {
                console.error(e);
                document.getElementById('loading').classList.add('hidden');
                document.getElementById('error').classList.remove('hidden');
            }
        }

        // === RENDER ===
        function renderTable() {
            const sorted = [...coinsData].sort((a, b) => {
                if (currentSort.field === 'score') return currentSort.direction === 'desc' ? b.score - a.score : a.score - b.score;
                return a.display_name.localeCompare(b.display_name);
            });

            const tbody = document.getElementById('coins-table');
            const existingRows = {};
            tbody.querySelectorAll('tr').forEach(row => existingRows[row.id] = row);

            sorted.forEach(coin => {
                const rowId = `row-${coin.symbol.replace(/\./g, '-')}`;
                let row = existingRows[rowId];
                if (!row) {
                    row = document.createElement('tr');
                    row.id = rowId;
                    row.className = 'data-row';
                    tbody.appendChild(row);
                }

                const maxScore = 10;
                const scorePercent = Math.min(100, (Math.abs(coin.score) / maxScore) * 100);
                const isBullish = coin.score > 0;
                const scoreBarClass = isBullish ? 'bullish' : coin.score < 0 ? 'bearish' : '';
                const scoreColor = isBullish ? 'text-emerald-400' : coin.score < 0 ? 'text-rose-400' : 'text-gray-500';
                const iconGradient = getIconGradient(coin.display_name);

                row.innerHTML = `
                    <td class="px-6 py-4">
                        <div class="flex items-center gap-4">
                            <div class="coin-icon w-11 h-11 rounded-xl ${iconGradient} flex items-center justify-center shadow-lg">
                                <span class="text-sm font-bold text-white">${coin.display_name.substring(0, 2)}</span>
                            </div>
                            <div>
                                <div class="coin-name font-semibold text-white text-base">${coin.display_name}</div>
                                <div class="text-[11px] text-gray-600 font-mono mt-0.5">${coin.symbol}</div>
                            </div>
                        </div>
                    </td>
                    <td class="px-4 py-4">
                        <div class="flex flex-col items-center gap-2">
                            <span class="score-value ${scoreColor} font-bold text-lg">${coin.score > 0 ? '+' : ''}${coin.score}</span>
                            <div class="score-bar-container w-full h-1.5">
                                <div class="score-bar ${scoreBarClass}" style="width: ${scorePercent}%"></div>
                            </div>
                        </div>
                    </td>
                    <td class="px-4 py-4 text-center">${renderTrend(coin.trends['1w'])}</td>
                    <td class="px-4 py-4 text-center">${renderTrend(coin.trends['3d'])}</td>
                    <td class="px-4 py-4 text-center">${renderTrend(coin.trends['1d'])}</td>
                    <td class="px-4 py-4">${renderSignal(coin.last_signal)}</td>
                    <td class="px-6 py-4 text-right">
                        <span class="text-xs text-gray-600">${formatTime(coin.last_updated_minutes_ago)}</span>
                    </td>
                `;
                tbody.appendChild(row);
            });

            // Remove stale rows
            const currentIds = new Set(sorted.map(c => `row-${c.symbol.replace(/\./g, '-')}`));
            Object.keys(existingRows).forEach(id => { if (!currentIds.has(id)) existingRows[id].remove(); });
        }

        function getIconGradient(name) {
            const gradients = {
                'HYPE': 'bg-gradient-to-br from-violet-500 to-purple-600',
                'VIRTUAL': 'bg-gradient-to-br from-cyan-500 to-blue-600',
                'FARTCOIN': 'bg-gradient-to-br from-amber-500 to-orange-600',
                'PEPE': 'bg-gradient-to-br from-emerald-500 to-green-600',
                'DOGE': 'bg-gradient-to-br from-yellow-500 to-amber-600',
                'BTC': 'bg-gradient-to-br from-orange-500 to-yellow-600',
                'ETH': 'bg-gradient-to-br from-indigo-500 to-purple-600',
                'SOL': 'bg-gradient-to-br from-purple-500 to-pink-600',
            };
            return gradients[name] || 'bg-gradient-to-br from-gray-600 to-gray-700';
        }

        function renderTrend(trend) {
            if (!trend) return '<div class="trend-indicator neutral"><span class="text-lg">–</span></div>';
            if (trend === 'uptrend') return '<div class="trend-indicator up"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M5 15l7-7 7 7"/></svg></div>';
            return '<div class="trend-indicator down"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M19 9l-7 7-7-7"/></svg></div>';
        }

        function renderSignal(signal) {
            if (!signal?.type) return '<span class="text-gray-700 text-xs">No signal</span>';
            const isBuy = signal.type === 'buy';
            return `
                <div class="signal-badge ${isBuy ? 'buy' : 'sell'}">
                    <span>${isBuy ? '● BUY' : '● SELL'}</span>
                    <span class="opacity-50 text-[10px]">${formatTime(signal.minutes_ago)}</span>
                </div>
            `;
        }

        function formatTime(min) {
            if (min == null) return '—';
            if (min < 1) return 'now';
            if (min < 60) return `${min}m`;
            const h = Math.floor(min / 60);
            if (h < 24) return `${h}h`;
            const d = Math.floor(h / 24);
            return `${d}d`;
        }

        // === INIT ===
        fetchCoins();
        setInterval(fetchCoins, REFRESH_INTERVAL);
        document.addEventListener('visibilitychange', () => { if (document.visibilityState === 'visible') fetchCoins(); });
    </script>
</body>
</html>
